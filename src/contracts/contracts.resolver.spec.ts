import { Test, TestingModule } from '@nestjs/testing'
import { EventsService } from '../events/events.service'
import { ContractsResolver } from './contracts.resolver'
import { ContractsService } from './contracts.service'
import { Contract } from './entity/contract.entity'
import { NotFoundException } from '@nestjs/common'

const mockContract = {
  address: '5F73xwbK9jtcG1YY38DG5wVLm42y15pCa8zE79snVT5z9X1t',
  metada: '',
  createdDate: '2022-08-25T22:49:21.66883',
}

const mockEvents = [
  {
    id: '34709348-7d86-5bb3-81ce-4320b3fd1f4e',
    transactionHash: '0x993010df0772d4fc25cad8fd07de5696d46d28858c00aec3457a8041be81bcf1',
    index: '0x0703',
    section: 'contracts',
    method: 'ContractEmitted',
    topics:
      '[0x0045726332303a3a5472616e7366657200000000000000000000000000000000, 0x33766995fd9b44bd45f351b3abd7e5041960638db0075c84ab7af1a734e20d1b, 0x5445726332303a3a5472616e736665723a3a66726f6d00000000000000000000]',
    data: `[
      "5C9QorN8S8X2Cwpa98cRevWR7YHmKqDGUPMDM3rZnLzWnRj9",
      "0x000001d43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d0000c52ebca2b1000000000000000000"
    ]`,
    createdDate: '2022-08-31 20:03:28.568881',
    contractAddress: '5C9QorN8S8X2Cwpa98cRevWR7YHmKqDGUPMDM3rZnLzWnRj9',
  },
  {
    id: '9a634dc2-bc75-5dfd-a804-18afcf91b065',
    transactionHash: '0x5d314cf3827604c4d07e7ebaa9372df2d8ede68a53acbf853535e249fbb1ea0a',
    index: '0x0703',
    section: 'contracts',
    method: 'ContractEmitted',
    topics:
      '[0x0045726332303a3a5472616e7366657200000000000000000000000000000000, 0x63c87cd1c4007df77d6b16ae28c5393bee3a62fb8577e38243a6f6f5a82c457f, 0xda2d695d3b5a304e0039e7fc4419c34fa0c1f239189c99bb72a6484f1634782b]',
    data: `[
      "5C9QorN8S8X2Cwpa98cRevWR7YHmKqDGUPMDM3rZnLzWnRj9",
      "0x0001d43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d01fe65717dad0447d715f660a0a58411de509b42e6efb8375f562f58a554d5860e0040e59c301200000000000000000000"
    ]`,
    createdDate: '2022-08-31 20:03:38.814484',
    contractAddress: '5C9QorN8S8X2Cwpa98cRevWR7YHmKqDGUPMDM3rZnLzWnRj9',
  },
]

const base64metadata =
  'ewogICJzb3VyY2UiOiB7CiAgICAiaGFzaCI6ICIweDNhYTFjOGJhNWY1OTAzNGE0MmE5M2MwMGVlMDM5YTk0NjRkNmZhNjNkNzBiNjg4OWEyNTk2ZjQ1MjhiMjhhMTkiLAogICAgImxhbmd1YWdlIjogImluayEgMy4zLjAiLAogICAgImNvbXBpbGVyIjogInJ1c3RjIDEuNjQuMC1uaWdodGx5IgogIH0sCiAgImNvbnRyYWN0IjogewogICAgIm5hbWUiOiAiZXJjMjAiLAogICAgInZlcnNpb24iOiAiMC4xLjAiLAogICAgImF1dGhvcnMiOiBbIlt5b3VyX25hbWVdIDxbeW91cl9lbWFpbF0+Il0KICB9LAogICJWMyI6IHsKICAgICJzcGVjIjogewogICAgICAiY29uc3RydWN0b3JzIjogWwogICAgICAgIHsKICAgICAgICAgICJhcmdzIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgImxhYmVsIjogImluaXRpYWxfc3VwcGx5IiwKICAgICAgICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICAgICAgICJkaXNwbGF5TmFtZSI6IFsiQmFsYW5jZSJdLAogICAgICAgICAgICAgICAgInR5cGUiOiAwCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICBdLAogICAgICAgICAgImRvY3MiOiBbIkNyZWF0ZXMgYSBuZXcgRVJDLTIwIGNvbnRyYWN0IHdpdGggdGhlIHNwZWNpZmllZCBpbml0aWFsIHN1cHBseS4iXSwKICAgICAgICAgICJsYWJlbCI6ICJuZXciLAogICAgICAgICAgInBheWFibGUiOiBmYWxzZSwKICAgICAgICAgICJzZWxlY3RvciI6ICIweDliYWU5ZDVlIgogICAgICAgIH0KICAgICAgXSwKICAgICAgImRvY3MiOiBbXSwKICAgICAgImV2ZW50cyI6IFsKICAgICAgICB7CiAgICAgICAgICAiYXJncyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICJkb2NzIjogW10sCiAgICAgICAgICAgICAgImluZGV4ZWQiOiB0cnVlLAogICAgICAgICAgICAgICJsYWJlbCI6ICJmcm9tIiwKICAgICAgICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICAgICAgICJkaXNwbGF5TmFtZSI6IFsiT3B0aW9uIl0sCiAgICAgICAgICAgICAgICAidHlwZSI6IDExCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgImRvY3MiOiBbXSwKICAgICAgICAgICAgICAiaW5kZXhlZCI6IHRydWUsCiAgICAgICAgICAgICAgImxhYmVsIjogInRvIiwKICAgICAgICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICAgICAgICJkaXNwbGF5TmFtZSI6IFsiT3B0aW9uIl0sCiAgICAgICAgICAgICAgICAidHlwZSI6IDExCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgImRvY3MiOiBbXSwKICAgICAgICAgICAgICAiaW5kZXhlZCI6IGZhbHNlLAogICAgICAgICAgICAgICJsYWJlbCI6ICJ2YWx1ZSIsCiAgICAgICAgICAgICAgInR5cGUiOiB7CiAgICAgICAgICAgICAgICAiZGlzcGxheU5hbWUiOiBbIkJhbGFuY2UiXSwKICAgICAgICAgICAgICAgICJ0eXBlIjogMAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgXSwKICAgICAgICAgICJkb2NzIjogWyIgRXZlbnQgZW1pdHRlZCB3aGVuIGEgdG9rZW4gdHJhbnNmZXIgb2NjdXJzLiJdLAogICAgICAgICAgImxhYmVsIjogIlRyYW5zZmVyIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgImFyZ3MiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAiZG9jcyI6IFtdLAogICAgICAgICAgICAgICJpbmRleGVkIjogdHJ1ZSwKICAgICAgICAgICAgICAibGFiZWwiOiAib3duZXIiLAogICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgImRpc3BsYXlOYW1lIjogWyJBY2NvdW50SWQiXSwKICAgICAgICAgICAgICAgICJ0eXBlIjogMgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICJkb2NzIjogW10sCiAgICAgICAgICAgICAgImluZGV4ZWQiOiB0cnVlLAogICAgICAgICAgICAgICJsYWJlbCI6ICJzcGVuZGVyIiwKICAgICAgICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICAgICAgICJkaXNwbGF5TmFtZSI6IFsiQWNjb3VudElkIl0sCiAgICAgICAgICAgICAgICAidHlwZSI6IDIKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAiZG9jcyI6IFtdLAogICAgICAgICAgICAgICJpbmRleGVkIjogZmFsc2UsCiAgICAgICAgICAgICAgImxhYmVsIjogInZhbHVlIiwKICAgICAgICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICAgICAgICJkaXNwbGF5TmFtZSI6IFsiQmFsYW5jZSJdLAogICAgICAgICAgICAgICAgInR5cGUiOiAwCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICBdLAogICAgICAgICAgImRvY3MiOiBbCiAgICAgICAgICAgICIgRXZlbnQgZW1pdHRlZCB3aGVuIGFuIGFwcHJvdmFsIG9jY3VycyB0aGF0IGBzcGVuZGVyYCBpcyBhbGxvd2VkIHRvIHdpdGhkcmF3IiwKICAgICAgICAgICAgIiB1cCB0byB0aGUgYW1vdW50IG9mIGB2YWx1ZWAgdG9rZW5zIGZyb20gYG93bmVyYC4iCiAgICAgICAgICBdLAogICAgICAgICAgImxhYmVsIjogIkFwcHJvdmFsIgogICAgICAgIH0KICAgICAgXSwKICAgICAgIm1lc3NhZ2VzIjogWwogICAgICAgIHsKICAgICAgICAgICJhcmdzIjogW10sCiAgICAgICAgICAiZG9jcyI6IFsiIFJldHVybnMgdGhlIHRvdGFsIHRva2VuIHN1cHBseS4iXSwKICAgICAgICAgICJsYWJlbCI6ICJ0b3RhbF9zdXBwbHkiLAogICAgICAgICAgIm11dGF0ZXMiOiBmYWxzZSwKICAgICAgICAgICJwYXlhYmxlIjogZmFsc2UsCiAgICAgICAgICAicmV0dXJuVHlwZSI6IHsKICAgICAgICAgICAgImRpc3BsYXlOYW1lIjogWyJCYWxhbmNlIl0sCiAgICAgICAgICAgICJ0eXBlIjogMAogICAgICAgICAgfSwKICAgICAgICAgICJzZWxlY3RvciI6ICIweGRiNjM3NWE4IgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgImFyZ3MiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAibGFiZWwiOiAib3duZXIiLAogICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgImRpc3BsYXlOYW1lIjogWyJBY2NvdW50SWQiXSwKICAgICAgICAgICAgICAgICJ0eXBlIjogMgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgXSwKICAgICAgICAgICJkb2NzIjogWwogICAgICAgICAgICAiIFJldHVybnMgdGhlIGFjY291bnQgYmFsYW5jZSBmb3IgdGhlIHNwZWNpZmllZCBgb3duZXJgLiIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAiIFJldHVybnMgYDBgIGlmIHRoZSBhY2NvdW50IGlzIG5vbi1leGlzdGVudC4iCiAgICAgICAgICBdLAogICAgICAgICAgImxhYmVsIjogImJhbGFuY2Vfb2YiLAogICAgICAgICAgIm11dGF0ZXMiOiBmYWxzZSwKICAgICAgICAgICJwYXlhYmxlIjogZmFsc2UsCiAgICAgICAgICAicmV0dXJuVHlwZSI6IHsKICAgICAgICAgICAgImRpc3BsYXlOYW1lIjogWyJCYWxhbmNlIl0sCiAgICAgICAgICAgICJ0eXBlIjogMAogICAgICAgICAgfSwKICAgICAgICAgICJzZWxlY3RvciI6ICIweDBmNzU1YTU2IgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgImFyZ3MiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAibGFiZWwiOiAib3duZXIiLAogICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgImRpc3BsYXlOYW1lIjogWyJBY2NvdW50SWQiXSwKICAgICAgICAgICAgICAgICJ0eXBlIjogMgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICJsYWJlbCI6ICJzcGVuZGVyIiwKICAgICAgICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICAgICAgICJkaXNwbGF5TmFtZSI6IFsiQWNjb3VudElkIl0sCiAgICAgICAgICAgICAgICAidHlwZSI6IDIKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIF0sCiAgICAgICAgICAiZG9jcyI6IFsKICAgICAgICAgICAgIiBSZXR1cm5zIHRoZSBhbW91bnQgd2hpY2ggYHNwZW5kZXJgIGlzIHN0aWxsIGFsbG93ZWQgdG8gd2l0aGRyYXcgZnJvbSBgb3duZXJgLiIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAiIFJldHVybnMgYDBgIGlmIG5vIGFsbG93YW5jZSBoYXMgYmVlbiBzZXQuIgogICAgICAgICAgXSwKICAgICAgICAgICJsYWJlbCI6ICJhbGxvd2FuY2UiLAogICAgICAgICAgIm11dGF0ZXMiOiBmYWxzZSwKICAgICAgICAgICJwYXlhYmxlIjogZmFsc2UsCiAgICAgICAgICAicmV0dXJuVHlwZSI6IHsKICAgICAgICAgICAgImRpc3BsYXlOYW1lIjogWyJCYWxhbmNlIl0sCiAgICAgICAgICAgICJ0eXBlIjogMAogICAgICAgICAgfSwKICAgICAgICAgICJzZWxlY3RvciI6ICIweDZhMDAxNjVlIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgImFyZ3MiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAibGFiZWwiOiAidG8iLAogICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgImRpc3BsYXlOYW1lIjogWyJBY2NvdW50SWQiXSwKICAgICAgICAgICAgICAgICJ0eXBlIjogMgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICJsYWJlbCI6ICJ2YWx1ZSIsCiAgICAgICAgICAgICAgInR5cGUiOiB7CiAgICAgICAgICAgICAgICAiZGlzcGxheU5hbWUiOiBbIkJhbGFuY2UiXSwKICAgICAgICAgICAgICAgICJ0eXBlIjogMAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgXSwKICAgICAgICAgICJkb2NzIjogWwogICAgICAgICAgICAiIFRyYW5zZmVycyBgdmFsdWVgIGFtb3VudCBvZiB0b2tlbnMgZnJvbSB0aGUgY2FsbGVyJ3MgYWNjb3VudCB0byBhY2NvdW50IGB0b2AuIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgICIgT24gc3VjY2VzcyBhIGBUcmFuc2ZlcmAgZXZlbnQgaXMgZW1pdHRlZC4iLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgIiAjIEVycm9ycyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAiIFJldHVybnMgYEluc3VmZmljaWVudEJhbGFuY2VgIGVycm9yIGlmIHRoZXJlIGFyZSBub3QgZW5vdWdoIHRva2VucyBvbiIsCiAgICAgICAgICAgICIgdGhlIGNhbGxlcidzIGFjY291bnQgYmFsYW5jZS4iCiAgICAgICAgICBdLAogICAgICAgICAgImxhYmVsIjogInRyYW5zZmVyIiwKICAgICAgICAgICJtdXRhdGVzIjogdHJ1ZSwKICAgICAgICAgICJwYXlhYmxlIjogZmFsc2UsCiAgICAgICAgICAicmV0dXJuVHlwZSI6IHsKICAgICAgICAgICAgImRpc3BsYXlOYW1lIjogWyJSZXN1bHQiXSwKICAgICAgICAgICAgInR5cGUiOiA4CiAgICAgICAgICB9LAogICAgICAgICAgInNlbGVjdG9yIjogIjB4ODRhMTVkYTEiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiYXJncyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICJsYWJlbCI6ICJzcGVuZGVyIiwKICAgICAgICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICAgICAgICJkaXNwbGF5TmFtZSI6IFsiQWNjb3VudElkIl0sCiAgICAgICAgICAgICAgICAidHlwZSI6IDIKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAibGFiZWwiOiAidmFsdWUiLAogICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgImRpc3BsYXlOYW1lIjogWyJCYWxhbmNlIl0sCiAgICAgICAgICAgICAgICAidHlwZSI6IDAKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIF0sCiAgICAgICAgICAiZG9jcyI6IFsKICAgICAgICAgICAgIiBBbGxvd3MgYHNwZW5kZXJgIHRvIHdpdGhkcmF3IGZyb20gdGhlIGNhbGxlcidzIGFjY291bnQgbXVsdGlwbGUgdGltZXMsIHVwIHRvIiwKICAgICAgICAgICAgIiB0aGUgYHZhbHVlYCBhbW91bnQuIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgICIgSWYgdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgYWdhaW4gaXQgb3ZlcndyaXRlcyB0aGUgY3VycmVudCBhbGxvd2FuY2Ugd2l0aCBgdmFsdWVgLiIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAiIEFuIGBBcHByb3ZhbGAgZXZlbnQgaXMgZW1pdHRlZC4iCiAgICAgICAgICBdLAogICAgICAgICAgImxhYmVsIjogImFwcHJvdmUiLAogICAgICAgICAgIm11dGF0ZXMiOiB0cnVlLAogICAgICAgICAgInBheWFibGUiOiBmYWxzZSwKICAgICAgICAgICJyZXR1cm5UeXBlIjogewogICAgICAgICAgICAiZGlzcGxheU5hbWUiOiBbIlJlc3VsdCJdLAogICAgICAgICAgICAidHlwZSI6IDgKICAgICAgICAgIH0sCiAgICAgICAgICAic2VsZWN0b3IiOiAiMHg2ODEyNjZhMCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJhcmdzIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgImxhYmVsIjogImZyb20iLAogICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgImRpc3BsYXlOYW1lIjogWyJBY2NvdW50SWQiXSwKICAgICAgICAgICAgICAgICJ0eXBlIjogMgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICJsYWJlbCI6ICJ0byIsCiAgICAgICAgICAgICAgInR5cGUiOiB7CiAgICAgICAgICAgICAgICAiZGlzcGxheU5hbWUiOiBbIkFjY291bnRJZCJdLAogICAgICAgICAgICAgICAgInR5cGUiOiAyCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgImxhYmVsIjogInZhbHVlIiwKICAgICAgICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICAgICAgICJkaXNwbGF5TmFtZSI6IFsiQmFsYW5jZSJdLAogICAgICAgICAgICAgICAgInR5cGUiOiAwCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICBdLAogICAgICAgICAgImRvY3MiOiBbCiAgICAgICAgICAgICIgVHJhbnNmZXJzIGB2YWx1ZWAgdG9rZW5zIG9uIHRoZSBiZWhhbGYgb2YgYGZyb21gIHRvIHRoZSBhY2NvdW50IGB0b2AuIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgICIgVGhpcyBjYW4gYmUgdXNlZCB0byBhbGxvdyBhIGNvbnRyYWN0IHRvIHRyYW5zZmVyIHRva2VucyBvbiBvbmVzIGJlaGFsZiBhbmQvb3IiLAogICAgICAgICAgICAiIHRvIGNoYXJnZSBmZWVzIGluIHN1Yi1jdXJyZW5jaWVzLCBmb3IgZXhhbXBsZS4iLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgIiBPbiBzdWNjZXNzIGEgYFRyYW5zZmVyYCBldmVudCBpcyBlbWl0dGVkLiIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAiICMgRXJyb3JzIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgICIgUmV0dXJucyBgSW5zdWZmaWNpZW50QWxsb3dhbmNlYCBlcnJvciBpZiB0aGVyZSBhcmUgbm90IGVub3VnaCB0b2tlbnMgYWxsb3dlZCIsCiAgICAgICAgICAgICIgZm9yIHRoZSBjYWxsZXIgdG8gd2l0aGRyYXcgZnJvbSBgZnJvbWAuIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgICIgUmV0dXJucyBgSW5zdWZmaWNpZW50QmFsYW5jZWAgZXJyb3IgaWYgdGhlcmUgYXJlIG5vdCBlbm91Z2ggdG9rZW5zIG9uIiwKICAgICAgICAgICAgIiB0aGUgYWNjb3VudCBiYWxhbmNlIG9mIGBmcm9tYC4iCiAgICAgICAgICBdLAogICAgICAgICAgImxhYmVsIjogInRyYW5zZmVyX2Zyb20iLAogICAgICAgICAgIm11dGF0ZXMiOiB0cnVlLAogICAgICAgICAgInBheWFibGUiOiBmYWxzZSwKICAgICAgICAgICJyZXR1cm5UeXBlIjogewogICAgICAgICAgICAiZGlzcGxheU5hbWUiOiBbIlJlc3VsdCJdLAogICAgICAgICAgICAidHlwZSI6IDgKICAgICAgICAgIH0sCiAgICAgICAgICAic2VsZWN0b3IiOiAiMHgwYjM5NmYxOCIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICAic3RvcmFnZSI6IHsKICAgICAgInN0cnVjdCI6IHsKICAgICAgICAiZmllbGRzIjogWwogICAgICAgICAgewogICAgICAgICAgICAibGF5b3V0IjogewogICAgICAgICAgICAgICJjZWxsIjogewogICAgICAgICAgICAgICAgImtleSI6ICIweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAiLAogICAgICAgICAgICAgICAgInR5IjogMAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm5hbWUiOiAidG90YWxfc3VwcGx5IgogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgImxheW91dCI6IHsKICAgICAgICAgICAgICAiY2VsbCI6IHsKICAgICAgICAgICAgICAgICJrZXkiOiAiMHgwMTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwIiwKICAgICAgICAgICAgICAgICJ0eSI6IDEKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJuYW1lIjogImJhbGFuY2VzIgogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgImxheW91dCI6IHsKICAgICAgICAgICAgICAiY2VsbCI6IHsKICAgICAgICAgICAgICAgICJrZXkiOiAiMHgwMjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwIiwKICAgICAgICAgICAgICAgICJ0eSI6IDYKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJuYW1lIjogImFsbG93YW5jZXMiCiAgICAgICAgICB9CiAgICAgICAgXQogICAgICB9CiAgICB9LAogICAgInR5cGVzIjogWwogICAgICB7CiAgICAgICAgImlkIjogMCwKICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICJkZWYiOiB7CiAgICAgICAgICAgICJwcmltaXRpdmUiOiAidTEyOCIKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIHsKICAgICAgICAiaWQiOiAxLAogICAgICAgICJ0eXBlIjogewogICAgICAgICAgImRlZiI6IHsKICAgICAgICAgICAgImNvbXBvc2l0ZSI6IHsKICAgICAgICAgICAgICAiZmllbGRzIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAibmFtZSI6ICJvZmZzZXRfa2V5IiwKICAgICAgICAgICAgICAgICAgInR5cGUiOiA1LAogICAgICAgICAgICAgICAgICAidHlwZU5hbWUiOiAiS2V5IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICJwYXJhbXMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAibmFtZSI6ICJLIiwKICAgICAgICAgICAgICAidHlwZSI6IDIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICJuYW1lIjogIlYiLAogICAgICAgICAgICAgICJ0eXBlIjogMAogICAgICAgICAgICB9CiAgICAgICAgICBdLAogICAgICAgICAgInBhdGgiOiBbImlua19zdG9yYWdlIiwgImxhenkiLCAibWFwcGluZyIsICJNYXBwaW5nIl0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIHsKICAgICAgICAiaWQiOiAyLAogICAgICAgICJ0eXBlIjogewogICAgICAgICAgImRlZiI6IHsKICAgICAgICAgICAgImNvbXBvc2l0ZSI6IHsKICAgICAgICAgICAgICAiZmllbGRzIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAidHlwZSI6IDMsCiAgICAgICAgICAgICAgICAgICJ0eXBlTmFtZSI6ICJbdTg7IDMyXSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAicGF0aCI6IFsiaW5rX2VudiIsICJ0eXBlcyIsICJBY2NvdW50SWQiXQogICAgICAgIH0KICAgICAgfSwKICAgICAgewogICAgICAgICJpZCI6IDMsCiAgICAgICAgInR5cGUiOiB7CiAgICAgICAgICAiZGVmIjogewogICAgICAgICAgICAiYXJyYXkiOiB7CiAgICAgICAgICAgICAgImxlbiI6IDMyLAogICAgICAgICAgICAgICJ0eXBlIjogNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICB7CiAgICAgICAgImlkIjogNCwKICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICJkZWYiOiB7CiAgICAgICAgICAgICJwcmltaXRpdmUiOiAidTgiCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICB7CiAgICAgICAgImlkIjogNSwKICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICJkZWYiOiB7CiAgICAgICAgICAgICJjb21wb3NpdGUiOiB7CiAgICAgICAgICAgICAgImZpZWxkcyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgInR5cGUiOiAzLAogICAgICAgICAgICAgICAgICAidHlwZU5hbWUiOiAiW3U4OyAzMl0iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgXQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgInBhdGgiOiBbImlua19wcmltaXRpdmVzIiwgIktleSJdCiAgICAgICAgfQogICAgICB9LAogICAgICB7CiAgICAgICAgImlkIjogNiwKICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICJkZWYiOiB7CiAgICAgICAgICAgICJjb21wb3NpdGUiOiB7CiAgICAgICAgICAgICAgImZpZWxkcyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgIm5hbWUiOiAib2Zmc2V0X2tleSIsCiAgICAgICAgICAgICAgICAgICJ0eXBlIjogNSwKICAgICAgICAgICAgICAgICAgInR5cGVOYW1lIjogIktleSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAicGFyYW1zIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIm5hbWUiOiAiSyIsCiAgICAgICAgICAgICAgInR5cGUiOiA3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAibmFtZSI6ICJWIiwKICAgICAgICAgICAgICAidHlwZSI6IDAKICAgICAgICAgICAgfQogICAgICAgICAgXSwKICAgICAgICAgICJwYXRoIjogWyJpbmtfc3RvcmFnZSIsICJsYXp5IiwgIm1hcHBpbmciLCAiTWFwcGluZyJdCiAgICAgICAgfQogICAgICB9LAogICAgICB7CiAgICAgICAgImlkIjogNywKICAgICAgICAidHlwZSI6IHsKICAgICAgICAgICJkZWYiOiB7CiAgICAgICAgICAgICJ0dXBsZSI6IFsyLCAyXQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgewogICAgICAgICJpZCI6IDgsCiAgICAgICAgInR5cGUiOiB7CiAgICAgICAgICAiZGVmIjogewogICAgICAgICAgICAidmFyaWFudCI6IHsKICAgICAgICAgICAgICAidmFyaWFudHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiA5CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAiaW5kZXgiOiAwLAogICAgICAgICAgICAgICAgICAibmFtZSI6ICJPayIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAxMAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgImluZGV4IjogMSwKICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiRXJyIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICJwYXJhbXMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAibmFtZSI6ICJUIiwKICAgICAgICAgICAgICAidHlwZSI6IDkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICJuYW1lIjogIkUiLAogICAgICAgICAgICAgICJ0eXBlIjogMTAKICAgICAgICAgICAgfQogICAgICAgICAgXSwKICAgICAgICAgICJwYXRoIjogWyJSZXN1bHQiXQogICAgICAgIH0KICAgICAgfSwKICAgICAgewogICAgICAgICJpZCI6IDksCiAgICAgICAgInR5cGUiOiB7CiAgICAgICAgICAiZGVmIjogewogICAgICAgICAgICAidHVwbGUiOiBbXQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgewogICAgICAgICJpZCI6IDEwLAogICAgICAgICJ0eXBlIjogewogICAgICAgICAgImRlZiI6IHsKICAgICAgICAgICAgInZhcmlhbnQiOiB7CiAgICAgICAgICAgICAgInZhcmlhbnRzIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAiaW5kZXgiOiAwLAogICAgICAgICAgICAgICAgICAibmFtZSI6ICJJbnN1ZmZpY2llbnRCYWxhbmNlIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgImluZGV4IjogMSwKICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiSW5zdWZmaWNpZW50QWxsb3dhbmNlIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICJwYXRoIjogWyJlcmMyMCIsICJlcmMyMCIsICJFcnJvciJdCiAgICAgICAgfQogICAgICB9LAogICAgICB7CiAgICAgICAgImlkIjogMTEsCiAgICAgICAgInR5cGUiOiB7CiAgICAgICAgICAiZGVmIjogewogICAgICAgICAgICAidmFyaWFudCI6IHsKICAgICAgICAgICAgICAidmFyaWFudHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICJpbmRleCI6IDAsCiAgICAgICAgICAgICAgICAgICJuYW1lIjogIk5vbmUiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAiZmllbGRzIjogWwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogMgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgImluZGV4IjogMSwKICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiU29tZSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAicGFyYW1zIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIm5hbWUiOiAiVCIsCiAgICAgICAgICAgICAgInR5cGUiOiAyCiAgICAgICAgICAgIH0KICAgICAgICAgIF0sCiAgICAgICAgICAicGF0aCI6IFsiT3B0aW9uIl0KICAgICAgICB9CiAgICAgIH0KICAgIF0KICB9Cn0K'

describe('ContractsResolver', () => {
  let resolver: ContractsResolver
  let service: ContractsService

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        ContractsResolver,
        {
          provide: ContractsService,
          useFactory: () => ({
            findOne: jest.fn(() => mockContract),
            uploadMetadata: jest.fn(() => true),
          }),
        },
        {
          provide: EventsService,
          useFactory: () => ({
            fetchEvents: jest.fn(() => mockEvents),
          }),
        },
      ],
    }).compile()

    resolver = module.get<ContractsResolver>(ContractsResolver)
    service = module.get<ContractsService>(ContractsService)
  })

  it('should be defined', () => {
    expect(resolver).toBeDefined()
  })

  describe('getContract', () => {
    it('should get a contract by hash', async () => {
      const contract = await resolver.getContract(mockContract.address)
      expect(contract).toEqual(mockContract)
    })
  })

  describe('uploadMetada', () => {
    it('should update the metada for a contract', async () => {
      const contract = await resolver.uploadMetadata(base64metadata, mockContract.address)
      expect(contract).toBe(true)
    })

    it('should show an error message for invalidad base64 metada', async () => {
      const contract = resolver.uploadMetadata('quwihy4ecf83921pnhyf091p28', mockContract.address)
      expect(contract).rejects.toThrow(Error)
    })

    it('should show an error message for not found contract', async () => {
      jest
        .spyOn(service, 'findOne')
        .mockRejectedValueOnce(new NotFoundException(`Contract with address: 123 not found`))

      const contract = resolver.uploadMetadata(base64metadata, '123')
      expect(contract).rejects.toThrow(NotFoundException)
    })
  })

  describe('getEvents', () => {
    it('should get events of a contract', async () => {
      const events = await resolver.getEvents({ address: mockContract.address } as Contract)
      expect(events).toBe(mockEvents)
    })
  })
})
